import json

from decksite.scrapers import tappedout


def test_parse_inventory():
    j = json.loads("""{"user_display": "cronofenix", "name": "Hapatrah", "url": "http://tappedout.net/mtg-decks/hapatrah/", "featured_card": "Obelisk Spider (HOU)", "date_updated": 1517016488, "score": 0, "inventory": [["Archfiend of Ifnir (000)", {"tla": "000", "b": "main", "qty": 1}], ["Banewhip Punisher", {"tla": "HOU", "b": "main", "qty": 1}], ["Bellowing Tanglewurm", {"tla": "SOM", "b": "main", "qty": 1}], ["Blighted Woodland (BFZ)", {"tla": "BFZ", "b": "main", "qty": 1}], ["Blowfly Infestation", {"tla": "SHM", "b": "main", "qty": 1}], ["Carnifex Demon", {"tla": "SOM", "b": "main", "qty": 1}], ["Cascading Cataracts", {"tla": "AKH", "b": "main", "qty": 1}], ["Chainbreaker", {"tla": "SHM", "b": "maybe", "qty": 1}], ["Cinderhaze Wretch", {"tla": "SHM", "b": "main", "qty": 1}], ["Claws of Wirewood", {"tla": "SCG", "b": "main", "qty": 1}], ["Contagion Engine", {"tla": "SOM", "b": "main", "qty": 1}], ["Core Prowler", {"tla": "MBS", "b": "main", "qty": 1}], ["Corrosive Mentor", {"tla": "SHM", "b": "main", "qty": 1}], ["Decimator Beetle", {"tla": "AKH", "b": "main", "qty": 1}], ["Defiant Greatmaw", {"tla": "AKH", "b": "main", "qty": 1}], ["Desert of the Glorified", {"tla": "HOU", "b": "main", "qty": 1}], ["Desert of the Indomitable", {"tla": "HOU", "b": "main", "qty": 1}], ["Diabolic Tutor (KLD)", {"tla": "KLD", "b": "main", "qty": 1}], ["Dread Return (TSP)", {"tla": "TSP", "b": "main", "qty": 1}], ["Elfhame Sanctuary", {"tla": "INV", "b": "main", "qty": 1}], ["Eliminate the Competition", {"tla": "KLD", "b": "main", "qty": 1}], ["Emrakul's Evangel", {"tla": "EMN", "b": "main", "qty": 1}], ["Extinguish All Hope", {"tla": "JOU", "b": "main", "qty": 1}], ["Falkenrath Noble (ISD)", {"tla": "ISD", "b": "maybe", "qty": 1}], ["Flesh-Eater Imp", {"tla": "MBS", "b": "main", "qty": 1}], ["Flourishing Defenses", {"tla": "SHM", "b": "main", "qty": 1}], ["Forest (UN3)", {"tla": "UN3", "b": "main", "qty": 14}], ["Foul Orchard", {"tla": "RIX", "b": "main", "qty": 1}], ["Glistening Oil", {"tla": "NPH", "b": "main", "qty": 1}], ["Gnarled Effigy", {"tla": "SHM", "b": "main", "qty": 1}], ["Golgari Guildgate (RTR)", {"tla": "RTR", "b": "main", "qty": 1}], ["Golgari Guildmage (RAV)", {"tla": "RAV", "b": "main", "qty": 1}], ["Golgari Signet (RAV)", {"tla": "RAV", "b": "main", "qty": 1}], ["Grafted Exoskeleton", {"tla": "SOM", "b": "main", "qty": 1}], ["Grasping Dunes", {"tla": "AKH", "b": "main", "qty": 1}], ["Grim Affliction (NPH)", {"tla": "NPH", "b": "main", "qty": 1}], ["Grim Backwoods (DKA)", {"tla": "DKA", "b": "main", "qty": 1}], ["Hapatra, Vizier of Poisons CMDR", {"tla": "AKH", "b": "main", "cmdr": true, "qty": 1}], ["Hunter of Eyeblights", {"tla": "LRW", "b": "main", "qty": 1}], ["Incremental Blight (SHM)", {"tla": "SHM", "b": "main", "qty": 1}], ["Jund Panorama (ALA)", {"tla": "ALA", "b": "main", "qty": 1}], ["Lockjaw Snapper", {"tla": "SHM", "b": "main", "qty": 1}], ["Manglehorn", {"tla": "AKH", "b": "main", "qty": 1}], ["Midnight Banshee (SHM)", {"tla": "SHM", "b": "main", "qty": 1}], ["Mortuary Mire", {"tla": "BFZ", "b": "main", "qty": 1}], ["Naturalize (ONS)", {"tla": "ONS", "b": "main", "qty": 1}], ["Necrogenesis (ALA)", {"tla": "ALA", "b": "main", "qty": 1}], ["Necroskitter (EVE)", {"tla": "EVE", "b": "main", "qty": 1}], ["Nest of Scarabs", {"tla": "AKH", "b": "main", "qty": 1}], ["Nezumi Bone-Reader", {"tla": "CHK", "b": "main", "qty": 1}], ["Nullmage Shepherd", {"tla": "RAV", "b": "main", "qty": 1}], ["Obelisk Spider", {"tla": "HOU", "b": "main", "qty": 1}], ["Overrun (TMP)", {"tla": "TMP", "b": "main", "qty": 1}], ["Phyrexian Hydra", {"tla": "MBS", "b": "main", "qty": 1}], ["Phyrexian Swarmlord", {"tla": "NPH", "b": "main", "qty": 1}], ["Plague Boiler (RAV)", {"tla": "RAV", "b": "main", "qty": 1}], ["Plaguemaw Beast", {"tla": "MBS", "b": "main", "qty": 1}], ["Power Conduit", {"tla": "MRD", "b": "main", "qty": 1}], ["Puppeteer Clique (SHM)", {"tla": "SHM", "b": "main", "qty": 1}], ["Rampant Growth (000)", {"tla": "000", "b": "main", "qty": 1}], ["Razaketh's Rite", {"tla": "HOU", "b": "main", "qty": 1}], ["Reaper of Sheoldred", {"tla": "NPH", "b": "main", "qty": 1}], ["Renegade Map", {"tla": "AER", "b": "main", "qty": 1}], ["Revel in Riches", {"tla": "XLN", "b": "main", "qty": 1}], ["Sachi, Daughter of Seshiro", {"tla": "CHK", "b": "main", "qty": 1}], ["Savra, Queen of the Golgari", {"tla": "RAV", "b": "main", "qty": 1}], ["Second Harvest", {"tla": "SOI", "b": "main", "qty": 1}], ["Skinrender", {"tla": "SOM", "b": "main", "qty": 1}], ["Sosuke, Son of Seshiro", {"tla": "CHK", "b": "main", "qty": 1}], ["Soul Snuffers", {"tla": "EVE", "b": "main", "qty": 1}], ["Soulstinger", {"tla": "AKH", "b": "main", "qty": 1}], ["Splendid Agony", {"tla": "AKH", "b": "main", "qty": 1}], ["Sunset Pyramid", {"tla": "HOU", "b": "main", "qty": 1}], ["Swamp (UN3)", {"tla": "UN3", "b": "main", "qty": 11}], ["Thaumatic Compass", {"tla": "XLN", "b": "main", "qty": 1}], ["Vampiric Rites", {"tla": "BFZ", "b": "main", "qty": 1}], ["Vhati il-Dal (TMP)", {"tla": "TMP", "b": "main", "qty": 1}], ["Vivid Marsh (LRW)", {"tla": "LRW", "b": "main", "qty": 1}], ["Whispersilk Cloak (DST)", {"tla": "DST", "b": "main", "qty": 1}]], "resource_uri": "http://tappedout.net/api/collection/collection:deck/hapatrah/", "thumbnail_url": "//static.tappedout.net/chart/0-0-60-0-40.png", "slug": "hapatrah", "small_thumbnail_url": "//static.tappedout.net/chart/0-0-60-0-40-small.png", "user": "cronofenix"}""")
    d = tappedout.parse_inventory(j['inventory'])
    assert len(d['sideboard']) == 0
    assert sum(d['maindeck'].values()) == 100
